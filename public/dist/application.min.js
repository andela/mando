"use strict";var ApplicationConfiguration=function(){var applicationModuleName="andonation",applicationModuleVendorDependencies=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("campaign"),ApplicationConfiguration.registerModule("core");var helper=require("./helpers");describe("Andonation Authentication",function(){beforeEach(function(){helper.loadApp("/")});var signInButton=element(by.id("signIn"));it("should accept only emails with andela.co domain name",function(){helper.logoutifLoggedIn(),helper.login("mirabelkoso@gmail.com","divinemimi");var myAndonation=browser.driver.findElement(by.id("myAndonation"));expect(myAndonation.isDisplayed()).toBe(!1);var myCampaign=browser.driver.findElement(by.id("myCampaign"));expect(myCampaign.isDisplayed()).toBe(!1),expect(signInButton.isDisplayed()).toBe(!0),helper.logoutifLoggedIn()})});var helper=require("./helpers");describe("Andonation HomePage",function(){it("should have a title",function(){helper.loadApp(),expect(browser.getTitle()).toEqual("Andonation")})});var elements={signInButton:element(by.id("signIn")),signoutButton:element(by.id("signout"))},helpers={loadApp:function(initialUrl){initialUrl=initialUrl||"/",browser.get(initialUrl)},login:function(email,password){email=email||"adebayo.maborukoje@andela.co",password=password||"maborukoje2012",elements.signInButton.click();var emailInput=browser.driver.findElement(by.id("Email"));emailInput.sendKeys(email);var passwordInput=browser.driver.findElement(by.id("Passwd"));passwordInput.sendKeys(password);var googleSignIn=browser.driver.findElement(by.id("signIn"));googleSignIn.click(),browser.driver.sleep(2500);var submitApproveAccess=browser.driver.findElement(by.id("submit_approve_access"));submitApproveAccess.click(),browser.driver.sleep(5e3)},logoutifLoggedIn:function(){elements.signoutButton.isDisplayed().then(function(isPresent){isPresent&&elements.signoutButton.click()})}};module.exports=helpers;var helper=require("./helpers");describe("Andonation Homepage",function(){beforeEach(function(){helper.loadApp("/")});var signInButton=element(by.id("signIn"));it("should have a title",function(){expect(browser.getTitle()).toEqual("Andonation")}),it("should show the signin button to unathenticated users",function(){expect(signInButton.isDisplayed()).toBe(!0)}),it("should not show myAndonation button to unauthenticated users",function(){expect(element(by.id("myCampaign")).isDisplayed()).toBe(!1),expect(element(by.id("myAndonation")).isDisplayed()).toBe(!1)}),it("should display 'My Andonation' Upon Successful login",function(){helper.logoutifLoggedIn(),helper.login();var myAndonation=browser.driver.findElement(by.id("myAndonation"));expect(myAndonation.getText()).toBeDefined();var myCampaign=browser.driver.findElement(by.id("myCampaign"));expect(myCampaign.getText()).toBeDefined(),expect(signInButton.isDisplayed()).toBe(!1),helper.logoutifLoggedIn()}),it("should show the signin button after logging out",function(){expect(signInButton.isDisplayed()).toBe(!0)})}),ApplicationConfiguration.registerModule("users"),angular.module("campaign").config(["$stateProvider","$sceDelegateProvider",function($stateProvider,$sceDelegateProvider){$stateProvider.state("addCampaign",{url:"/campaign/add",templateUrl:"modules/campaigns/views/addCampaign.client.view.html"}).state("viewCampaign",{url:"/campaign/:campaignid",templateUrl:"modules/campaigns/views/viewCampaign.client.view.html"}),$sceDelegateProvider.resourceUrlWhitelist(["http://www.youtube.com/**"])}]),angular.module("campaign").controller("addCampaignCtrl",["$scope","backendService","$location","Authentication",function($scope,backendService,$location,Authentication){$scope.authentication=Authentication,$scope.campaign={},$scope.minDate=moment().format(),$scope.maxDate=moment().format(),$scope.authentication.user||$location.path("/"),$scope.addCampaign=function(){backendService.addCampaign($scope.campaign).success(function(data){console.log(data),$location.path("/campaign/"+data._id)}).error(function(error){console.log(error)})},$scope.open=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.opened=!0}}]),angular.module("campaign").controller("viewCampaignCtrl",["$scope","backendService","$location","Authentication","$stateParams",function($scope,backendService,$location,Authentication,$stateParams){$scope.authentication=Authentication,$scope.campaign={_id:$stateParams.campaignid},$scope.authentication.user||$location.path("/"),backendService.getCampaign($scope.campaign).success(function(data){var youtube=data.youtubeUrl.split("watch?v=");youtube.length>1&&(data.youtubeId="http://www.youtube.com/embed/"+youtube[1]),$scope.campaign=data,console.log(data)}).error(function(error){console.log(error)})}]),angular.module("campaign").factory("backendService",["$http",function($http){var addCampaign=function(campaignData){return $http.post("/campaign/add",campaignData)},getCampaign=function(campaignData){return $http.get("/campaign/"+campaignData._id)};return{addCampaign:addCampaign,getCampaign:getCampaign}}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/views/home.client.view.html"})}]),angular.module("core").controller("HeaderController",["$scope","Authentication",function($scope,Authentication){$scope.authentication=Authentication}]),angular.module("core").controller("HomeController",["$scope","Authentication",function($scope,Authentication){$scope.authentication=Authentication}]),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("/");break;case 403:}return $q.reject(rejection)}}}])}]),angular.module("users").factory("Authentication",[function(){var _this=this;return _this._data={user:window.user},_this._data}]);